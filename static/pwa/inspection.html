<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>안전점검 모듈</title>
  <meta
    http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data: https:; connect-src 'self'; object-src 'none'; base-uri 'self'; frame-ancestors 'self';"
  />
  <link rel="stylesheet" href="/pwa/inspection.css?v=20260219a" />
  <link rel="stylesheet" href="/pwa/light_theme.css?v=20260221a" />
</head>
<body>
  <header class="top">
    <div class="title">안전점검 모듈</div>
    <div class="actions">
      <a class="btn" href="/pwa/">메인으로</a>
      <button id="btnReload" class="btn" type="button">새로고침</button>
    </div>
  </header>

  <main class="main">
    <section class="card">
      <h2>접속 정보</h2>
      <div id="userLine" class="muted">로딩 중...</div>
      <div id="msg" class="msg"></div>
    </section>

    <section class="card">
      <h2>점검 생성</h2>
      <div class="row">
        <label class="field grow">
          <span>점검대상</span>
          <select id="targetId"></select>
        </label>
        <label class="field grow">
          <span>점검표</span>
          <select id="templateId"></select>
        </label>
      </div>
      <div class="row">
        <label class="field">
          <span>점검일자</span>
          <input id="runDate" type="date" />
        </label>
        <label class="field grow">
          <span>메모</span>
          <input id="runNote" type="text" placeholder="예: 월간 정기점검" />
        </label>
        <button id="btnCreateRun" class="btn primary" type="button">점검 생성</button>
      </div>
      <div class="row">
        <button id="btnEditTarget" class="btn" type="button">선택 점검대상 수정</button>
        <button id="btnDeleteTarget" class="btn danger" type="button">선택 점검대상 삭제</button>
        <button id="btnEditTemplate" class="btn" type="button">선택 점검표 수정</button>
        <button id="btnDeleteTemplate" class="btn danger" type="button">선택 점검표 삭제</button>
      </div>
    </section>

    <section id="setupCard" class="card" hidden>
      <h2>기초정보 빠른 설정</h2>
      <div id="setupHint" class="muted">점검대상/점검표가 없으면 점검을 생성할 수 없습니다.</div>
      <div class="row">
        <label class="field grow">
          <span>점검대상 리스트 제목</span>
          <input id="quickTargetName" type="text" placeholder="예: 공용시설 전기실 점검대상" />
        </label>
        <label class="field grow">
          <span>점검표 제목</span>
          <input id="quickTemplateName" type="text" placeholder="예: 월간 안전점검 체크리스트" />
        </label>
        <label class="field">
          <span>주기</span>
          <select id="quickTemplatePeriod">
            <option value="DAILY">DAILY</option>
            <option value="WEEKLY">WEEKLY</option>
            <option value="MONTHLY" selected>MONTHLY</option>
            <option value="QUARTERLY">QUARTERLY</option>
            <option value="YEARLY">YEARLY</option>
          </select>
        </label>
      </div>
      <div class="row">
        <label class="field">
          <span>대분류 개수</span>
          <input id="detailItemCount" type="number" min="1" max="10" step="1" value="1" />
        </label>
        <button id="btnLoadSelectedQuick" class="btn" type="button">선택 레코드 불러오기</button>
        <button id="btnBuildDetailItems" class="btn" type="button">트리 입력폼 만들기</button>
        <button id="btnQuickSetup" class="btn primary" type="button">리스트 폼 자동 생성</button>
      </div>
      <div id="detailItems" class="detail-items"></div>
      <div class="muted small">대분류는 필수이며, 중/소분류는 선택입니다. 중분류·소분류는 최대 10개까지 트리로 입력할 수 있습니다.</div>
      <div class="muted small">최고/운영관리자 또는 단지대표자 권한에서만 생성할 수 있습니다.</div>
    </section>

    <section class="card">
      <h2>점검 목록</h2>
      <div class="row">
        <label class="field">
          <span>상태</span>
          <select id="qStatus">
            <option value="">전체</option>
            <option value="DRAFT">DRAFT</option>
            <option value="SUBMITTED">SUBMITTED</option>
            <option value="REJECTED">REJECTED</option>
            <option value="ARCHIVED">ARCHIVED</option>
          </select>
        </label>
        <label class="field">
          <span>시작일</span>
          <input id="qDateFrom" type="date" />
        </label>
        <label class="field">
          <span>종료일</span>
          <input id="qDateTo" type="date" />
        </label>
        <button id="btnLoadRuns" class="btn" type="button">조회</button>
        <button id="btnExportRunsExcel" class="btn" type="button">엑셀 다운로드</button>
      </div>
      <div id="runs" class="list"></div>
    </section>

    <section id="detailCard" class="card" hidden>
      <h2>점검 상세</h2>
      <div id="runMeta" class="meta"></div>
      <div id="runActions" class="row">
        <button id="btnSaveItems" class="btn" type="button">항목 저장</button>
        <button id="btnSubmitRun" class="btn primary" type="button">제출</button>
        <label class="field inline">
          <span>승인코드</span>
          <input id="approvalCode" type="text" inputmode="numeric" maxlength="8" placeholder="코드 입력" />
        </label>
        <button id="btnIssueApprovalCode" class="btn" type="button">승인코드 발급</button>
        <button id="btnApproveRun" class="btn" type="button">승인</button>
        <button id="btnRejectRun" class="btn danger" type="button">반려</button>
        <button id="btnExportRunExcel" class="btn" type="button">상세 엑셀</button>
        <button id="btnVerifyArchive" class="btn" type="button">무결성 검증</button>
        <button id="btnOpenPdf" class="btn" type="button">보관 PDF</button>
      </div>
      <div id="verifyMsg" class="msg"></div>
      <div id="runItems" class="items"></div>
      <div id="runApprovals" class="approvals"></div>
    </section>
  </main>

  <script src="/pwa/auth.js?v=20260218a"></script>
  <script src="/pwa/common_utils.js?v=20260221a"></script>
  <script src="/pwa/module_base.js?v=20260219a"></script>
  <script src="/pwa/inspection.js?v=20260219a"></script>
</body>
</html>


